<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>‡∏™‡∏≤‡∏£‡∏≤‡∏ô‡∏∏‡∏Å‡∏£‡∏°‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå‡πÑ‡∏°‡πâ ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÇ‡∏™‡∏ï‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏Å‡∏≤‡∏ç‡∏à‡∏ô‡∏ö‡∏∏‡∏£‡∏µ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Sarabun", sans-serif;
      }
      .card {
        transition:
          transform 0.25s cubic-bezier(0.2, 0.8, 0.2, 1),
          box-shadow 0.25s ease;
      }
      .card:hover {
        transform: translateY(-6px) scale(1.02);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.12);
      }
      .fade-in {
        animation: fadeIn 0.25s ease both;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(6px);
        }
        to {
          opacity: 1;
          transform: none;
        }
      }
      .modal-enter {
        animation: modalIn 0.28s cubic-bezier(0.2, 0.8, 0.2, 1) both;
      }
      @keyframes modalIn {
        from {
          opacity: 0;
          transform: scale(0.96);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }
    </style>
  </head>
  <body class="bg-gradient-to-br from-purple-50 via-fuchsia-50 to-indigo-50 text-slate-800">
    <!-- HEADER -->
    <header class="bg-gradient-to-r from-violet-700 via-purple-700 to-fuchsia-600 text-white shadow-lg">
      <div class="mx-auto flex max-w-6xl items-center gap-4 px-4 py-5">
        <img
          src="PUT_SCHOOL_LOGO_URL_HERE"
          class="h-14 w-14 rounded-xl bg-white p-1 object-contain"
          alt="‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô"
        />
        <div>
          <h1 class="text-2xl font-bold md:text-3xl">‡∏™‡∏≤‡∏£‡∏≤‡∏ô‡∏∏‡∏Å‡∏£‡∏°‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå‡πÑ‡∏°‡πâ</h1>
          <p class="text-white/90">‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÇ‡∏™‡∏ï‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏Å‡∏≤‡∏ç‡∏à‡∏ô‡∏ö‡∏∏‡∏£‡∏µ ‚Ä¢ ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏†‡∏≤‡∏©‡∏≤‡∏°‡∏∑‡∏≠</p>
        </div>
      </div>
    </header>

    <!-- SEARCH -->
    <section class="mx-auto max-w-6xl px-4 py-4">
      <input
        id="search"
        type="text"
        placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ..."
        class="w-full rounded-xl border p-3 focus:outline-none focus:ring-2 focus:ring-purple-500"
      />
    </section>

    <!-- LEGEND + FILTER -->
    <section class="mx-auto max-w-6xl px-4 pb-4">
      <div class="rounded-2xl bg-white p-4 shadow">
        <div class="mb-2 text-sm font-semibold">‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏Ñ‡∏∏‡∏ì‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞</div>
        <div class="flex flex-wrap gap-2" id="tagFilters"></div>
      </div>
    </section>

    <!-- GRID -->
    <section class="mx-auto max-w-6xl px-4 pb-16">
      <div id="plantGrid" class="grid gap-6 md:grid-cols-2 lg:grid-cols-3"></div>
    </section>

    <!-- MODAL DETAIL -->
    <div
      id="modal"
      class="fixed inset-0 hidden items-center justify-center bg-black/50 p-3"
      onclick="backdropClose(event)"
    >
      <div class="modal-enter relative max-h-[92vh] w-full max-w-3xl overflow-hidden rounded-2xl bg-white">
        <button onclick="closeModal()" class="absolute right-4 top-3 z-10 text-slate-500">‚úï</button>
        <div id="modalContent" class="flex h-full flex-col"></div>
      </div>
    </div>

    <!-- ADMIN LOGIN MODAL -->
    <div
      id="loginModal"
      class="fixed inset-0 hidden items-center justify-center bg-black/50 p-4"
      onclick="closeLogin(event)"
    >
      <div class="modal-enter w-full max-w-sm rounded-2xl bg-white p-5" onclick="event.stopPropagation()">
        <div class="mb-2 flex items-center justify-between">
          <h3 class="text-lg font-bold">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•</h3>
          <button onclick="forceCloseLogin()" class="text-slate-400 hover:text-red-500">‚úï</button>
        </div>
        <p class="mb-3 text-xs text-slate-500">
          ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
        </p>
        <input id="adminPass" type="password" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" class="mb-3 w-full rounded border p-2" />
        <button onclick="loginAdmin()" class="w-full rounded bg-purple-600 py-2 text-white">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
        <button onclick="forceCloseLogin()" class="mt-2 w-full text-sm text-slate-500">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        <p id="loginErr" class="mt-2 hidden text-sm text-red-500">‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</p>
      </div>
    </div>

    <!-- ADMIN FLOAT BUTTON -->
    <button
      id="adminBtn"
      class="fixed bottom-6 right-6 rounded-full bg-purple-600 px-5 py-3 text-white shadow-lg hover:bg-purple-700"
    >
      Admin
    </button>

    <!-- ADMIN PANEL -->
    <div id="adminPanel" class="fixed inset-0 hidden items-center justify-center bg-black/50 p-4">
      <div class="modal-enter w-full max-w-3xl rounded-2xl bg-white p-5">
        <div class="mb-3 flex flex-wrap items-center justify-between gap-2">
          <h3 class="text-lg font-bold">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ</h3>
          <div class="flex items-center gap-2">
            <button
              onclick="exportPlants()"
              class="rounded-lg border border-purple-200 bg-white px-3 py-2 text-sm text-purple-700 hover:bg-purple-50"
            >
              Export JSON
            </button>
            <button
              onclick="triggerImport()"
              class="rounded-lg border border-purple-200 bg-white px-3 py-2 text-sm text-purple-700 hover:bg-purple-50"
            >
              Import JSON
            </button>
            <button
              onclick="resetPlants()"
              class="rounded-lg border border-red-200 bg-white px-3 py-2 text-sm text-red-600 hover:bg-red-50"
            >
              Reset
            </button>
            <button onclick="toggleAdmin()" class="px-2 py-2 text-slate-500 hover:text-slate-800">‚úï</button>
          </div>
        </div>

        <input id="importFile" class="hidden" type="file" accept="application/json" onchange="importPlants(event)" />

        <div class="mb-3">
          <label class="text-sm font-semibold">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</label>
          <select id="plantSelect" class="mt-1 w-full rounded border p-2" onchange="loadSelectedPlant()"></select>
        </div>

        <div class="grid grid-cols-2 gap-2 text-sm">
          <input id="a_name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ó‡∏¢" class="rounded border p-2" />
          <input id="a_sci" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏ó‡∏¢‡πå" class="rounded border p-2" />
          <input id="a_common" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏°‡∏±‡∏ç" class="rounded border p-2" />
          <input id="a_family" placeholder="‡∏ß‡∏á‡∏®‡πå" class="rounded border p-2" />
          <input id="a_tags" placeholder="tags ‡πÄ‡∏ä‡πà‡∏ô edible,fragrant" class="col-span-2 rounded border p-2" />
          <input id="a_img" placeholder="URL ‡∏£‡∏π‡∏õ" class="col-span-2 rounded border p-2" />
          <input id="a_vid" placeholder="URL ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ embed" class="col-span-2 rounded border p-2" />
          <textarea id="a_desc" placeholder="‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢" class="col-span-2 rounded border p-2"></textarea>
          <textarea id="a_high" placeholder="‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡πÄ‡∏î‡πà‡∏ô" class="col-span-2 rounded border p-2"></textarea>
        </div>
        <button onclick="saveAdmin()" class="mt-3 w-full rounded bg-purple-600 py-2 text-white">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
      </div>
    </div>

    <footer class="bg-slate-900 py-4 text-center text-white">
      ¬© 2026 ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÇ‡∏™‡∏ï‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏Å‡∏≤‡∏ç‡∏à‡∏ô‡∏ö‡∏∏‡∏£‡∏µ<br />
      <span class="text-sm text-white/80">‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏´‡∏•‡πà‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏®‡∏∂‡∏Å‡∏©‡∏≤: ‡∏ò‡∏ô‡∏ä‡∏±‡∏¢ ‡∏ô‡∏û‡∏ß‡∏±‡∏í‡∏ô‡πå</span>
    </footer>

    <!-- FEEDBACK BUTTON -->
    <button
      onclick="openFeedback()"
      class="fixed bottom-6 left-6 rounded-full bg-pink-600 px-4 py-3 text-white shadow-lg hover:bg-pink-700"
    >
      ‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞
    </button>

    <!-- FEEDBACK MODAL -->
    <div
      id="feedbackModal"
      class="fixed inset-0 hidden items-center justify-center bg-black/50 p-4"
      onclick="closeFeedback(event)"
    >
      <div class="w-full max-w-lg rounded-2xl bg-white p-5" onclick="event.stopPropagation()">
        <div class="mb-2 flex items-center justify-between">
          <h3 class="text-lg font-bold">‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞</h3>
          <button onclick="forceCloseFeedback()">‚úï</button>
        </div>
        <form onsubmit="submitFeedback(event)" class="space-y-3">
          <input id="fbEmail" required type="email" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì" class="w-full rounded border p-2" />
          <textarea
            id="fbMsg"
            required
            placeholder="‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞..."
            class="h-28 w-full rounded border p-2"
          ></textarea>
          <button class="w-full rounded bg-purple-600 py-2 text-white">‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞</button>
        </form>
        <p class="mt-2 text-xs text-slate-400">* ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Google Sheet ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</p>
      </div>
    </div>

    <script>
      // ===== TAG META =====
      const tagMeta = {
        toxic: { label: "‚ò†Ô∏è ‡∏°‡∏µ‡∏û‡∏¥‡∏©", chip: "bg-red-100 text-red-700 border-red-200", active: "bg-red-600 text-white" },
        fragrant: {
          label: "üå∏ ‡∏Å‡∏•‡∏¥‡πà‡∏ô‡∏´‡∏≠‡∏°",
          chip: "bg-pink-100 text-pink-700 border-pink-200",
          active: "bg-pink-600 text-white",
        },
        smelly: {
          label: "ü§¢ ‡∏Å‡∏•‡∏¥‡πà‡∏ô‡πÅ‡∏£‡∏á",
          chip: "bg-amber-100 text-amber-800 border-amber-200",
          active: "bg-amber-600 text-white",
        },
        edible: {
          label: "üçΩ ‡∏Å‡∏¥‡∏ô‡πÑ‡∏î‡πâ",
          chip: "bg-emerald-100 text-emerald-700 border-emerald-200",
          active: "bg-emerald-600 text-white",
        },
        ornamental: {
          label: "üåø ‡πÑ‡∏°‡πâ‡∏õ‡∏£‡∏∞‡∏î‡∏±‡∏ö",
          chip: "bg-sky-100 text-sky-700 border-sky-200",
          active: "bg-sky-600 text-white",
        },
      };
      const allTags = Object.keys(tagMeta);
      let activeTag = null;

      // ===== ADMIN AUTH STATE =====
      let adminAuth = false;

      // ===== STORAGE =====
      const STORAGE_KEY = "plantsData_v1";
      const LEGACY_CUSTOM_KEY = "customPlants";

      const clonePlants = (list) =>
        (list || []).map((p) => ({ ...p, tags: Array.isArray(p.tags) ? [...p.tags] : [] }));

      function escapeHtml(value) {
        return String(value ?? "")
          .replaceAll("&", "&amp;")
          .replaceAll("<", "&lt;")
          .replaceAll(">", "&gt;")
          .replaceAll('"', "&quot;")
          .replaceAll("'", "&#39;");
      }

      function sanitizeUrl(value) {
        const raw = String(value ?? "").trim();
        if (!raw) return "";
        try {
          const parsed = new URL(raw, window.location.href);
          if (parsed.protocol !== "http:" && parsed.protocol !== "https:") return "";
          return parsed.toString();
        } catch {
          return "";
        }
      }

      function normalizePlant(input) {
        const tags = Array.isArray(input?.tags)
          ? input.tags.map((t) => String(t ?? "").trim()).filter(Boolean)
          : String(input?.tags ?? "")
              .split(",")
              .map((t) => t.trim())
              .filter(Boolean);

        return {
          name: String(input?.name ?? "").trim(),
          sci: String(input?.sci ?? "").trim(),
          common: String(input?.common ?? "").trim(),
          family: String(input?.family ?? "").trim(),
          desc: String(input?.desc ?? "").trim(),
          highlight: String(input?.highlight ?? "").trim(),
          tags,
          image: sanitizeUrl(input?.image ?? ""),
          video: sanitizeUrl(input?.video ?? ""),
        };
      }

      function loadPlants() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          if (raw) {
            const parsed = JSON.parse(raw);
            if (Array.isArray(parsed)) return parsed.map(normalizePlant);
          }
        } catch {}

        // Migration from legacy "customPlants"
        try {
          const legacyRaw = localStorage.getItem(LEGACY_CUSTOM_KEY);
          if (legacyRaw) {
            const legacy = JSON.parse(legacyRaw);
            if (Array.isArray(legacy)) {
              const combined = [...clonePlants(basePlants), ...legacy.map(normalizePlant)];
              savePlants(combined);
              return combined;
            }
          }
        } catch {}

        const defaults = clonePlants(basePlants).map(normalizePlant);
        savePlants(defaults);
        return defaults;
      }

      function savePlants(list) {
        try {
          localStorage.setItem(STORAGE_KEY, JSON.stringify((list || []).map(normalizePlant)));
        } catch {}
      }

      // ===== BASE DATA =====
      const basePlants = [
        {
          name: "‡∏•‡∏µ‡∏•‡∏≤‡∏ß‡∏î‡∏µ",
          sci: "Plumeria rubra",
          common: "Frangipani",
          family: "APOCYNACEAE",
          desc: "‡πÑ‡∏°‡πâ‡∏î‡∏≠‡∏Å‡∏´‡∏≠‡∏°‡∏ó‡∏µ‡πà‡∏ô‡∏¥‡∏¢‡∏°‡∏õ‡∏•‡∏π‡∏Å‡∏õ‡∏£‡∏∞‡∏î‡∏±‡∏ö",
          highlight: "‡∏î‡∏≠‡∏Å‡∏´‡∏≠‡∏° ‡∏¢‡∏≤‡∏á‡∏°‡∏µ‡∏û‡∏¥‡∏©",
          tags: ["fragrant", "toxic", "ornamental"],
          image: "PUT_IMAGE_URL_HERE",
          video: "PUT_VIDEO_URL_HERE",
        },
        {
          name: "‡∏Ç‡∏≤‡∏ô‡∏≤‡∏á",
          sci: "Homalium tomentosum",
          common: "Burma lancewood",
          family: "SALICACEAE",
          desc: "‡πÑ‡∏°‡πâ‡∏¢‡∏∑‡∏ô‡∏ï‡πâ‡∏ô‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà‡πÉ‡∏ô‡∏õ‡πà‡∏≤‡πÑ‡∏ó‡∏¢",
          highlight: "‡πÑ‡∏°‡πâ‡∏™‡∏π‡∏á‡∏ó‡∏£‡∏á‡∏™‡∏ß‡∏¢",
          tags: ["ornamental"],
          image: "PUT_IMAGE_URL_HERE",
          video: "PUT_VIDEO_URL_HERE",
        },
        {
          name: "‡∏´‡∏ß‡πâ‡∏≤",
          sci: "Syzygium cumini",
          common: "Java Plum",
          family: "MYRTACEAE",
          desc: "‡πÑ‡∏°‡πâ‡∏ú‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ö‡πâ‡∏≤‡∏ô‡πÉ‡∏´‡πâ‡∏£‡πà‡∏°‡πÄ‡∏á‡∏≤",
          highlight: "‡∏ú‡∏•‡∏°‡πà‡∏ß‡∏á‡∏î‡∏≥‡∏Å‡∏¥‡∏ô‡πÑ‡∏î‡πâ",
          tags: ["edible", "ornamental"],
          image: "PUT_IMAGE_URL_HERE",
          video: "PUT_VIDEO_URL_HERE",
        },
        {
          name: "‡∏™‡∏∞‡πÄ‡∏î‡∏≤",
          sci: "Azadirachta indica",
          common: "Neem",
          family: "MELIACEAE",
          desc: "‡πÑ‡∏°‡πâ‡∏™‡∏°‡∏∏‡∏ô‡πÑ‡∏û‡∏£",
          highlight: "‡πÉ‡∏ö‡∏Ç‡∏°‡πÉ‡∏ä‡πâ‡∏¢‡∏≤",
          tags: ["edible"],
          image: "PUT_IMAGE_URL_HERE",
          video: "PUT_VIDEO_URL_HERE",
        },
        {
          name: "‡∏°‡∏∞‡∏Ç‡∏≤‡∏°",
          sci: "Tamarindus indica",
          common: "Tamarind",
          family: "FABACEAE",
          desc: "‡πÑ‡∏°‡πâ‡∏ú‡∏•‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏Å‡∏¥‡∏à",
          highlight: "‡∏ù‡∏±‡∏Å‡πÄ‡∏õ‡∏£‡∏µ‡πâ‡∏¢‡∏ß‡∏≠‡∏°‡∏´‡∏ß‡∏≤‡∏ô",
          tags: ["edible"],
          image: "PUT_IMAGE_URL_HERE",
          video: "PUT_VIDEO_URL_HERE",
        },
        {
          name: "‡∏ï‡∏∞‡∏•‡∏¥‡∏á‡∏õ‡∏•‡∏¥‡∏á",
          sci: "Averrhoa bilimbi",
          common: "Bilimbi",
          family: "OXALIDACEAE",
          desc: "‡∏ú‡∏•‡πÄ‡∏õ‡∏£‡∏µ‡πâ‡∏¢‡∏ß‡∏à‡∏±‡∏î",
          highlight: "‡∏ú‡∏•‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏Å‡∏¥‡∏ô‡πÑ‡∏î‡πâ",
          tags: ["edible"],
          image: "PUT_IMAGE_URL_HERE",
          video: "PUT_VIDEO_URL_HERE",
        },
        {
          name: "‡∏™‡∏±‡∏Å",
          sci: "Tectona grandis",
          common: "Teak",
          family: "LAMIACEAE",
          desc: "‡πÑ‡∏°‡πâ‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏Å‡∏¥‡∏à",
          highlight: "‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡πÑ‡∏°‡πâ‡πÅ‡∏Ç‡πá‡∏á",
          tags: ["ornamental"],
          image: "PUT_IMAGE_URL_HERE",
          video: "PUT_VIDEO_URL_HERE",
        },
        {
          name: "‡∏£‡∏≤‡∏ä‡∏û‡∏§‡∏Å‡∏©‡πå",
          sci: "Cassia fistula",
          common: "Golden Shower",
          family: "FABACEAE",
          desc: "‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ä‡∏≤‡∏ï‡∏¥",
          highlight: "‡∏î‡∏≠‡∏Å‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á‡∏™‡∏ß‡∏¢",
          tags: ["fragrant", "ornamental"],
          image: "PUT_IMAGE_URL_HERE",
          video: "PUT_VIDEO_URL_HERE",
        },
        {
          name: "‡∏°‡∏∞‡∏°‡πà‡∏ß‡∏á",
          sci: "Mangifera indica",
          common: "Mango",
          family: "ANACARDIACEAE",
          desc: "‡πÑ‡∏°‡πâ‡∏ú‡∏•‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°",
          highlight: "‡∏ú‡∏•‡∏´‡∏ß‡∏≤‡∏ô‡∏´‡∏≠‡∏°",
          tags: ["edible", "fragrant"],
          image: "PUT_IMAGE_URL_HERE",
          video: "PUT_VIDEO_URL_HERE",
        },
        {
          name: "‡∏Ç‡∏µ‡πâ‡πÄ‡∏´‡∏•‡πá‡∏Å",
          sci: "Senna siamea",
          common: "Kassod",
          family: "FABACEAE",
          desc: "‡πÑ‡∏°‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏ö‡πâ‡∏≤‡∏ô",
          highlight: "‡πÉ‡∏ö‡∏Å‡∏¥‡∏ô‡πÑ‡∏î‡πâ",
          tags: ["edible"],
          image: "PUT_IMAGE_URL_HERE",
          video: "PUT_VIDEO_URL_HERE",
        },
        {
          name: "‡∏≠‡πÇ‡∏®‡∏Å‡∏≠‡∏¥‡∏ô‡πÄ‡∏î‡∏µ‡∏¢",
          sci: "Polyalthia longifolia",
          common: "Indian Mast",
          family: "ANNONACEAE",
          desc: "‡πÑ‡∏°‡πâ‡∏õ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ó‡∏£‡∏á‡∏™‡∏π‡∏á",
          highlight: "‡∏ó‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ß",
          tags: ["ornamental"],
          image: "PUT_IMAGE_URL_HERE",
          video: "PUT_VIDEO_URL_HERE",
        },
        {
          name: "‡∏õ‡∏≤‡∏•‡πå‡∏°‡∏ü‡∏≠‡∏Å‡∏ã‡πå‡πÄ‡∏ó‡∏•",
          sci: "Wodyetia bifurcata",
          common: "Foxtail Palm",
          family: "ARECACEAE",
          desc: "‡∏õ‡∏≤‡∏•‡πå‡∏°‡∏™‡∏ß‡∏¢",
          highlight: "‡πÉ‡∏ö‡∏û‡∏∏‡πà‡∏°‡∏ü‡∏π",
          tags: ["ornamental"],
          image: "PUT_IMAGE_URL_HERE",
          video: "PUT_VIDEO_URL_HERE",
        },
        {
          name: "‡∏´‡∏π‡∏Å‡∏£‡∏∞‡∏à‡∏á",
          sci: "Terminalia catappa",
          common: "Tropical Almond",
          family: "COMBRETACEAE",
          desc: "‡πÑ‡∏°‡πâ‡πÉ‡∏´‡πâ‡∏£‡πà‡∏°",
          highlight: "‡πÉ‡∏ö‡πÉ‡∏´‡∏ç‡πà",
          tags: ["edible", "ornamental"],
          image: "PUT_IMAGE_URL_HERE",
          video: "PUT_VIDEO_URL_HERE",
        },
        {
          name: "‡∏õ‡∏≤‡∏•‡πå‡∏°‡∏û‡∏±‡∏î",
          sci: "Livistona rotundifolia",
          common: "Fan Palm",
          family: "ARECACEAE",
          desc: "‡∏õ‡∏≤‡∏•‡πå‡∏°‡πÉ‡∏ö‡∏û‡∏±‡∏î",
          highlight: "‡πÉ‡∏ö‡∏Å‡∏•‡∏°",
          tags: ["ornamental"],
          image: "PUT_IMAGE_URL_HERE",
          video: "PUT_VIDEO_URL_HERE",
        },
        {
          name: "‡∏û‡∏¢‡∏π‡∏á",
          sci: "Dalbergia cochinchinensis",
          common: "Rosewood",
          family: "FABACEAE",
          desc: "‡πÑ‡∏°‡πâ‡∏´‡∏ß‡∏á‡∏´‡πâ‡∏≤‡∏°",
          highlight: "‡πÑ‡∏°‡πâ‡∏•‡∏≤‡∏¢‡∏™‡∏ß‡∏¢",
          tags: ["ornamental"],
          image: "PUT_IMAGE_URL_HERE",
          video: "PUT_VIDEO_URL_HERE",
        },
        {
          name: "‡∏ó‡∏≠‡∏á‡∏Å‡∏ß‡∏≤‡∏ß",
          sci: "Butea monosperma",
          common: "Flame",
          family: "FABACEAE",
          desc: "‡∏î‡∏≠‡∏Å‡∏™‡∏µ‡∏™‡πâ‡∏°",
          highlight: "‡∏î‡∏≠‡∏Å‡∏™‡∏î",
          tags: ["fragrant", "ornamental"],
          image: "PUT_IMAGE_URL_HERE",
          video: "PUT_VIDEO_URL_HERE",
        },
        {
          name: "‡∏Å‡∏•‡πâ‡∏ß‡∏¢",
          sci: "Musa spp.",
          common: "Banana",
          family: "MUSACEAE",
          desc: "‡∏û‡∏∑‡∏ä‡∏≠‡∏≤‡∏´‡∏≤‡∏£",
          highlight: "‡∏ú‡∏•‡∏Å‡∏¥‡∏ô‡πÑ‡∏î‡πâ",
          tags: ["edible"],
          image: "PUT_IMAGE_URL_HERE",
          video: "PUT_VIDEO_URL_HERE",
        },
        {
          name: "‡πÅ‡∏õ‡∏£‡∏á‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡∏ß‡∏î",
          sci: "Callistemon citrinus",
          common: "Bottlebrush",
          family: "MYRTACEAE",
          desc: "‡πÑ‡∏°‡πâ‡∏î‡∏≠‡∏Å",
          highlight: "‡∏î‡∏≠‡∏Å‡πÅ‡∏î‡∏á",
          tags: ["fragrant", "ornamental"],
          image: "PUT_IMAGE_URL_HERE",
          video: "PUT_VIDEO_URL_HERE",
        },
        {
          name: "‡∏õ‡∏£‡∏∞‡∏î‡∏π‡πà",
          sci: "Pterocarpus macrocarpus",
          common: "Padauk",
          family: "FABACEAE",
          desc: "‡πÑ‡∏°‡πâ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡πÅ‡∏Ç‡πá‡∏á",
          highlight: "‡πÑ‡∏°‡πâ‡∏ó‡∏ô",
          tags: ["ornamental"],
          image: "PUT_IMAGE_URL_HERE",
          video: "PUT_VIDEO_URL_HERE",
        },
        {
          name: "‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á‡∏õ‡∏£‡∏µ‡∏î‡∏µ‡∏¢‡∏≤‡∏ò‡∏£",
          sci: "Peltophorum pterocarpum",
          common: "Yellow Flame",
          family: "FABACEAE",
          desc: "‡∏î‡∏≠‡∏Å‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á",
          highlight: "‡∏î‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡πà‡∏≠",
          tags: ["fragrant", "ornamental"],
          image: "PUT_IMAGE_URL_HERE",
          video: "PUT_VIDEO_URL_HERE",
        },
        {
          name: "‡∏ï‡∏µ‡∏ô‡πÄ‡∏õ‡πá‡∏î",
          sci: "Alstonia scholaris",
          common: "Devil Tree",
          family: "APOCYNACEAE",
          desc: "‡∏°‡∏µ‡∏Å‡∏•‡∏¥‡πà‡∏ô‡πÅ‡∏£‡∏á",
          highlight: "‡∏¢‡∏≤‡∏á‡∏°‡∏µ‡∏û‡∏¥‡∏©",
          tags: ["toxic", "smelly", "ornamental"],
          image: "PUT_IMAGE_URL_HERE",
          video: "PUT_VIDEO_URL_HERE",
        },
      ];

      let plants = loadPlants();

      const grid = document.getElementById("plantGrid");
      const search = document.getElementById("search");
      const filterWrap = document.getElementById("tagFilters");

      function renderFilters() {
        filterWrap.innerHTML = "";
        const allBtn = document.createElement("button");
        allBtn.textContent = "‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î";
        allBtn.className = `px-3 py-1 rounded-full border ${
          activeTag === null ? "bg-purple-600 text-white" : "bg-slate-100"
        }`;
        allBtn.onclick = () => {
          activeTag = null;
          update();
        };
        filterWrap.appendChild(allBtn);
        allTags.forEach((tag) => {
          const meta = tagMeta[tag];
          const btn = document.createElement("button");
          btn.textContent = meta.label;
          btn.className = `px-3 py-1 rounded-full border ${activeTag === tag ? meta.active : meta.chip}`;
          btn.onclick = () => {
            activeTag = activeTag === tag ? null : tag;
            update();
          };
          filterWrap.appendChild(btn);
        });
      }

      function render(list) {
        grid.innerHTML = "";

        if (!list.length) {
          const empty = document.createElement("div");
          empty.className = "col-span-full rounded-2xl bg-white p-6 text-center text-slate-500 shadow";
          empty.textContent = "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
          grid.appendChild(empty);
          return;
        }

        list.forEach((p) => {
          const card = document.createElement("div");
          card.className = "card fade-in cursor-pointer overflow-hidden rounded-2xl bg-white shadow";
          card.onclick = () => openModal(p);

          const tags = Array.isArray(p.tags) ? p.tags : [];
          const tagsHTML = tags
            .filter(Boolean)
            .map((t) => {
              const meta = tagMeta[t] || { label: t, chip: "bg-slate-100 text-slate-700 border-slate-200" };
              return `<span class="text-[11px] px-2 py-0.5 rounded-full border ${meta.chip}">${escapeHtml(
                meta.label,
              )}</span>`;
            })
            .join(" ");

          const imageUrl = sanitizeUrl(p.image);
          const cover =
            imageUrl && !imageUrl.includes("PUT")
              ? `<img src="${escapeHtml(imageUrl)}" class="w-full h-36 object-cover" alt="${escapeHtml(p.name)}"/>`
              : `<div class="w-full h-36 bg-slate-100 flex items-center justify-center text-slate-400">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ</div>`;

          card.innerHTML = `
            ${cover}
            <div class="p-4">
              <h3 class="font-bold text-purple-700">${escapeHtml(p.name)}</h3>
              <div class="flex flex-wrap gap-1 my-2">${tagsHTML}</div>
              <p class="text-sm text-slate-600">${escapeHtml(p.desc)}</p>
            </div>`;
          grid.appendChild(card);
        });
      }

      function openModal(p) {
        const modal = document.getElementById("modal");
        const content = document.getElementById("modalContent");
        modal.classList.remove("hidden");

        const safeVideoUrl = sanitizeUrl(p.video);
        const video =
          safeVideoUrl && !safeVideoUrl.includes("PUT")
            ? `<iframe class="w-full h-full rounded-xl" src="${escapeHtml(safeVideoUrl)}" allowfullscreen></iframe>`
            : `<div class="flex items-center justify-center h-full text-slate-400">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠</div>`;

        const safeImageUrl = sanitizeUrl(p.image);
        const img =
          safeImageUrl && !safeImageUrl.includes("PUT")
            ? `<img src="${escapeHtml(
                safeImageUrl,
              )}" class="rounded-xl w-full h-56 md:h-64 object-cover" alt="${escapeHtml(p.name)}"/>`
            : `<div class="h-56 md:h-64 bg-slate-100 rounded-xl flex items-center justify-center text-slate-400">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ</div>`;

        content.innerHTML = `
          <div class="bg-gradient-to-r from-violet-700 via-purple-700 to-fuchsia-600 text-white p-4">
            <h2 class="text-xl md:text-2xl font-bold">${escapeHtml(p.name)}</h2>
            <p class="text-white/80 italic text-sm">${escapeHtml(p.sci)}</p>
          </div>

          <div class="flex-1 overflow-y-auto p-4">
            <div class="grid md:grid-cols-2 gap-4 mb-4">
              ${img}
              <div class="space-y-2 text-sm">
                <div><b>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏°‡∏±‡∏ç:</b> ${escapeHtml(p.common)}</div>
                <div><b>‡∏ß‡∏á‡∏®‡πå:</b> ${escapeHtml(p.family)}</div>
                <div class="bg-slate-50 p-3 rounded-lg"><b>‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡πÄ‡∏î‡πà‡∏ô:</b><br>${escapeHtml(p.highlight).replaceAll(
                  "\n",
                  "<br>",
                )}</div>
              </div>
            </div>

            <div class="sticky top-0 bg-white py-2">
              <div class="flex flex-wrap gap-2" id="plantTabs">
                <button class="tabBtn px-3 py-2 rounded-lg bg-purple-600 text-white text-sm" data-tab="video">
                  ‡∏†‡∏≤‡∏©‡∏≤‡∏°‡∏∑‡∏≠
                </button>
                <button class="tabBtn px-3 py-2 rounded-lg bg-slate-100 text-sm" data-tab="general">
                  ‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
                </button>
                <button class="tabBtn px-3 py-2 rounded-lg bg-slate-100 text-sm" data-tab="distribution">
                  ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå
                </button>
                <button class="tabBtn px-3 py-2 rounded-lg bg-slate-100 text-sm" data-tab="benefit">
                  ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå
                </button>
                <button class="tabBtn px-3 py-2 rounded-lg bg-slate-100 text-sm" data-tab="reference">
                  ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á
                </button>
              </div>
            </div>

            <div id="tabContent" class="mt-3"></div>
          </div>
        `;

        const tabContent = document.getElementById("tabContent");
        const tabs = document.querySelectorAll(".tabBtn");

        const renderTab = (name) => {
          if (name === "video") {
            tabContent.innerHTML = `
              <div class="font-semibold mb-2 text-lg">‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏†‡∏≤‡∏©‡∏≤‡∏°‡∏∑‡∏≠</div>
              <div class="w-full bg-black rounded-2xl overflow-hidden shadow-lg">${video}</div>
              <p class="text-xs text-slate-400 mt-2">‡πÉ‡∏ä‡πâ‡∏•‡∏¥‡∏á‡∏Å‡πå YouTube embed (‡πÄ‡∏ä‡πà‡∏ô /embed/xxxx) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠‡∏™‡∏ß‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</p>`;
            return;
          }
          if (name === "general") {
            tabContent.innerHTML = `
              <div class="bg-slate-50 p-4 rounded-xl text-sm">
                <b>‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢:</b><br>${escapeHtml(p.desc || "-").replaceAll("\n", "<br>")}
              </div>`;
            return;
          }
          if (name === "distribution") {
            tabContent.innerHTML = `
              <div class="grid md:grid-cols-2 gap-3 text-sm">
                <div class="bg-blue-50 p-3 rounded-xl"><b>‡∏ñ‡∏¥‡πà‡∏ô‡∏Å‡∏≥‡πÄ‡∏ô‡∏¥‡∏î</b><br>‡∏û‡∏ö‡πÉ‡∏ô‡πÄ‡∏Ç‡∏ï‡∏£‡πâ‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏≠‡πÄ‡∏ä‡∏µ‡∏¢</div>
                <div class="bg-purple-50 p-3 rounded-xl"><b>‡∏Å‡∏≤‡∏£‡∏õ‡∏•‡∏π‡∏Å‡πÉ‡∏ô‡πÑ‡∏ó‡∏¢</b><br>‡∏û‡∏ö‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡πÉ‡∏ô‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡∏∞‡∏ä‡∏∏‡∏°‡∏ä‡∏ô</div>
              </div>`;
            return;
          }
          if (name === "benefit") {
            tabContent.innerHTML = `
              <div class="bg-purple-50 p-3 rounded-xl text-sm">
                ‡πÉ‡∏ä‡πâ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡∏î‡πâ‡∏≤‡∏ô‡∏†‡∏π‡∏°‡∏¥‡∏ó‡∏±‡∏®‡∏ô‡πå ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏£‡∏±‡∏Å‡∏©‡πå‡∏û‡∏£‡∏£‡∏ì‡πÑ‡∏°‡πâ‡πÉ‡∏ô‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
              </div>`;
            return;
          }
          if (name === "reference") {
            tabContent.innerHTML = `
              <div class="bg-white border border-purple-200 p-4 rounded-xl text-sm space-y-2">
                <div class="font-semibold text-purple-700">‡πÅ‡∏´‡∏•‡πà‡∏á‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á</div>
                <ul class="list-disc pl-5 space-y-1 text-slate-700">
                  <li>‡∏Å‡∏£‡∏°‡∏≠‡∏∏‡∏ó‡∏¢‡∏≤‡∏ô‡πÅ‡∏´‡πà‡∏á‡∏ä‡∏≤‡∏ï‡∏¥ ‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏õ‡πà‡∏≤ ‡πÅ‡∏•‡∏∞‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå‡∏û‡∏∑‡∏ä</li>
                  <li>Flora of Thailand Database</li>
                  <li>‡∏™‡∏ß‡∏ô‡∏û‡∏§‡∏Å‡∏©‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (‡∏™‡∏™‡∏ß‡∏ó.)</li>
                  <li>‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏£‡∏£‡∏ì‡πÑ‡∏°‡πâ‡πÉ‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢ (Thai Plant Database)</li>
                </ul>
                <p class="text-xs text-slate-400">* ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö Admin ‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï</p>
              </div>`;
            return;
          }
        };

        tabs.forEach((btn) => {
          btn.onclick = () => {
            tabs.forEach((b) => b.classList.remove("bg-purple-600", "text-white"));
            tabs.forEach((b) => b.classList.add("bg-slate-100"));
            btn.classList.add("bg-purple-600", "text-white");
            btn.classList.remove("bg-slate-100");
            renderTab(btn.dataset.tab);
          };
        });

        renderTab("video");
      }

      function closeModal() {
        document.getElementById("modal").classList.add("hidden");
      }
      function backdropClose(e) {
        if (e.target.id === "modal") closeModal();
      }
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") closeModal();
      });

      function applyFilters() {
        const q = search.value.toLowerCase().trim();
        let list = plants;
        if (q) {
          list = list.filter((p) => `${p.name} ${p.sci} ${p.common}`.toLowerCase().includes(q));
        }
        if (activeTag) list = list.filter((p) => (p.tags || []).includes(activeTag));
        return list;
      }
      function update() {
        renderFilters();
        render(applyFilters());
      }
      search.addEventListener("input", update);

      // ===== ADMIN =====
      const adminBtn = document.getElementById("adminBtn");
      const panel = document.getElementById("adminPanel");
      adminBtn.onclick = () => {
        if (!adminAuth) {
          document.getElementById("loginModal").classList.remove("hidden");
        } else toggleAdmin();
      };
      function toggleAdmin() {
        panel.classList.toggle("hidden");
        if (!panel.classList.contains("hidden")) populateAdminList();
      }
      function loginAdmin() {
        const val = document.getElementById("adminPass").value;
        if (val === "Sotkan-Tree") {
          adminAuth = true;
          forceCloseLogin();
          toggleAdmin();
        } else {
          document.getElementById("loginErr").classList.remove("hidden");
        }
      }

      function forceCloseLogin() {
        document.getElementById("loginModal").classList.add("hidden");
        document.getElementById("adminPass").value = "";
        document.getElementById("loginErr").classList.add("hidden");
      }
      function closeLogin(e) {
        if (e.target.id === "loginModal") forceCloseLogin();
      }
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") forceCloseLogin();
      });

      // ===== EDIT / SAVE =====
      let editIndex = null;
      function populateAdminList() {
        const select = document.getElementById("plantSelect");
        select.innerHTML = '<option value="">-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà --</option>';
        plants.forEach((p, i) => {
          const opt = document.createElement("option");
          opt.value = String(i);
          opt.textContent = p.name || `‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà ${i + 1}`;
          select.appendChild(opt);
        });
      }
      function loadSelectedPlant() {
        const val = document.getElementById("plantSelect").value;
        if (val === "") {
          editIndex = null;
          clearForm();
          return;
        }
        const p = plants[Number(val)];
        editIndex = Number(val);
        document.getElementById("a_name").value = p.name || "";
        document.getElementById("a_sci").value = p.sci || "";
        document.getElementById("a_common").value = p.common || "";
        document.getElementById("a_family").value = p.family || "";
        document.getElementById("a_desc").value = p.desc || "";
        document.getElementById("a_high").value = p.highlight || "";
        document.getElementById("a_tags").value = (p.tags || []).join(",");
        document.getElementById("a_img").value = p.image || "";
        document.getElementById("a_vid").value = p.video || "";
      }
      function clearForm() {
        ["a_name", "a_sci", "a_common", "a_family", "a_desc", "a_high", "a_tags", "a_img", "a_vid"].forEach(
          (id) => (document.getElementById(id).value = ""),
        );
      }
      function saveAdmin() {
        const item = normalizePlant({
          name: document.getElementById("a_name").value,
          sci: document.getElementById("a_sci").value,
          common: document.getElementById("a_common").value,
          family: document.getElementById("a_family").value,
          desc: document.getElementById("a_desc").value,
          highlight: document.getElementById("a_high").value,
          tags: document.getElementById("a_tags").value,
          image: document.getElementById("a_img").value,
          video: document.getElementById("a_vid").value,
        });

        if (!item.name) {
          alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ó‡∏¢");
          return;
        }

        if (editIndex !== null) plants[editIndex] = item;
        else plants.push(item);

        savePlants(plants);
        editIndex = null;
        clearForm();
        document.getElementById("plantSelect").value = "";
        toggleAdmin();
        update();
      }

      function exportPlants() {
        try {
          const blob = new Blob([JSON.stringify(plants, null, 2)], { type: "application/json" });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = "plants.json";
          document.body.appendChild(a);
          a.click();
          a.remove();
          URL.revokeObjectURL(url);
        } catch {
          alert("Export ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
        }
      }

      function triggerImport() {
        document.getElementById("importFile").click();
      }

      async function importPlants(e) {
        const file = e.target.files?.[0];
        e.target.value = "";
        if (!file) return;
        try {
          const text = await file.text();
          const parsed = JSON.parse(text);
          if (!Array.isArray(parsed)) throw new Error("Invalid JSON");
          plants = parsed.map(normalizePlant);
          savePlants(plants);
          update();
          populateAdminList();
          alert("‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
        } catch {
          alert("‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
        }
      }

      function resetPlants() {
        if (!confirm("‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô? (‡∏°‡∏µ‡∏ú‡∏•‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ)")) return;
        plants = clonePlants(basePlants).map(normalizePlant);
        savePlants(plants);
        update();
        populateAdminList();
        editIndex = null;
        clearForm();
        document.getElementById("plantSelect").value = "";
      }

      // ===== FEEDBACK (Google Sheet) =====
      const SHEET_API = "PUT_GOOGLE_SCRIPT_URL_HERE"; // ‡πÉ‡∏™‡πà Web App URL

      async function submitFeedback(e) {
        e.preventDefault();
        const email = document.getElementById("fbEmail").value;
        const message = document.getElementById("fbMsg").value;
        if (!SHEET_API.includes("http")) {
          alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Google Script URL");
          return;
        }
        try {
          await fetch(SHEET_API, {
            method: "POST",
            body: JSON.stringify({ email, message, source: "plant-web", time: new Date().toISOString() }),
            headers: { "Content-Type": "application/json" },
          });
          alert("‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡πÅ‡∏•‡πâ‡∏ß ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏±‡∏ö");
          forceCloseFeedback();
          document.getElementById("fbEmail").value = "";
          document.getElementById("fbMsg").value = "";
        } catch {
          alert("‡∏™‡πà‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï");
        }
      }

      // ===== FEEDBACK =====
      function openFeedback() {
        document.getElementById("feedbackModal").classList.remove("hidden");
      }
      function forceCloseFeedback() {
        document.getElementById("feedbackModal").classList.add("hidden");
      }
      function closeFeedback(e) {
        if (e.target.id === "feedbackModal") forceCloseFeedback();
      }
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") forceCloseFeedback();
      });

      // init
      renderFilters();
      render(applyFilters());
    </script>
  </body>
</html>

